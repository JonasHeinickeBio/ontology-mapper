[tox]
envlist = py38,py39,py310,py311,py312,flake8,mypy,security
isolated_build = True

[testenv]
deps =
    pytest>=7.0.0
    pytest-cov>=4.0.0
    pytest-mock>=3.10.0
    responses>=0.23.0
commands =
    pytest {posargs}

[testenv:flake8]
deps =
    flake8>=6.0.0
    flake8-docstrings
    flake8-bugbear
commands =
    flake8 .

[testenv:mypy]
deps =
    mypy>=1.0.0
    types-requests
commands =
    mypy .

[testenv:security]
deps =
    bandit>=1.7.0
    safety>=2.0.0
commands =
    bandit -r . -c pyproject.toml
    safety check

[testenv:coverage]
deps =
    pytest>=7.0.0
    pytest-cov>=4.0.0
commands =
    pytest --cov=. --cov-report=html --cov-report=term-missing

[testenv:docs]
deps =
    sphinx>=6.0.0
    sphinx-rtd-theme>=1.2.0
commands =
    sphinx-build -b html docs docs/_build/html

[testenv:format]
deps =
    black>=23.0.0
    isort>=5.12.0
commands =
    black .
    isort .

[testenv:lint]
deps =
    flake8>=6.0.0
    ruff>=0.0.270
commands =
    flake8 .
    ruff check .

[testenv:integration]
deps =
    pytest>=7.0.0
    pytest-cov>=4.0.0
    responses>=0.23.0
passenv =
    BIOPORTAL_API_KEY
    UMLS_API_KEY
commands =
    pytest -m integration {posargs}

[testenv:build]
deps =
    build
    twine
commands =
    python -m build
    twine check dist/*

[flake8]
max-line-length = 100
extend-ignore = E203, E501, W503
exclude = .git,__pycache__,build,dist,*.egg-info,.venv,venv
per-file-ignores =
    __init__.py:F401
    test_*.py:F401,F811
